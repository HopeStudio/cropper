!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,o){return void 0===o&&(o="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(o),o}:t(jQuery)}(function(t){"use strict";function e(t,e){var o=void 0;return t.naturalWidth&&!L?e(t.naturalWidth,t.naturalHeight):(o=document.createElement("img"),o.onload=function(){e(this.width,this.height)},void(o.src=t.src))}function o(t){return"string"==typeof t&&(t=t.replace(l,"$1-$2").toLowerCase())}function i(t){return!!t&&!(!t.nodeName||"img"!==t.nodeName.toLowerCase()||!t.src)}function n(t){if(u.test(t)){t=t.replace(RegExp.$1,"");for(var e=window.atob(t),o=e.length,i=new Uint8Array(o),n=0;n<o;n++)i[n]=e.charCodeAt(n);return i.buffer}}function r(e,i){var n=this.dom.$mask=t(W),r=this.dom.$wrap=n.find("#cropperBox"),c=this.dom.$client=n.find("#cropperBoxClient"),p=this.dom.$target=n.find("#cropperBoxClientTarget"),a=this.dom.$range=n.find("#cropperRange input"),s=this.dom.$btn=n.find("#cropperEnsure"),h=this.dom.$ele0=t("<img/>").attr({class:o(v),id:v,src:this.$element.attr("src")}).prependTo(r),d=this.dom.$ele1=t("<img/>").attr({class:o(g),id:g,src:this.$element.attr("src")}).prependTo(p),l=this.options.cropper.minSpace,f=this.cache.value=a.val(),u=t(window),m=void 0,w=void 0;e<t(window).width()-2*l&&i<t(window).height()-4*l?(m=this.cache.width=e,w=this.cache.height=i,this.cache.ratio=1):(e/i<=t(window).width()/t(window).height()?(w=this.cache.height=t(window).height()-4*l,m=this.cache.width=w*e/i):(m=this.cache.width=t(window).width()-2*l,w=this.cache.height=m*i/e),this.cache.ratio=m/e),n.css({width:u.width(),height:u.height(),backgroundColor:E,position:"fixed",top:0,left:0,zIndex:1e4}),r.css({width:m,height:w,position:"absolute",left:(n.width()-m)/2,top:(n.height()-w)/4,overflow:"hidden",backgroundColor:k}),h.css({width:m*f,position:"absolute",top:0,left:0}),n.prependTo("body"),s.css({top:r.height()+r.position().top+10,left:n.width()/2,marginLeft:-s.width()/2,position:"absolute"}),this.cache.wrapTop=r.position().top,this.cache.wrapLeft=r.position().left,this.options.range.pos===y?a.parent().css({top:this.cache.wrapTop-l,left:n.width()/2,marginLeft:-a.width()/2,position:"absolute"}):a.parent().css({top:w+this.cache.wrapTop+l,left:n.width()/2,marginLeft:-a.width()/2,position:"absolute"}),c.css({width:m,height:w,top:0,left:0}),d.css({position:"absolute",width:m*f,height:w*f,top:-this.options.cropper.antWidth,left:-this.options.cropper.antWidth}),t("style#cropperStyleSheet")[0]||t("<style/>").html(D).attr({id:"cropperStyleSheet"}).appendTo("head")}function c(){var e=this,o=this.dom.$client,i=this.dom.$ele0,n=this.dom.$ele1,r=void 0,c=void 0,p=void 0,a=void 0,s=void 0,h=void 0,d=void 0,l=function(t){if(t.preventDefault(),t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft>=0&&t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft<=e.cache.width&&t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop>=0&&t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop<=e.cache.height){switch(d){case x:o.css({top:t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop,height:c-(t.originalEvent.targetTouches[0].clientY-a)+2*e.options.cropper.antWidth});break;case b:o.css({height:t.originalEvent.targetTouches[0].clientY-a});break;case w:o.css({left:t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft,width:r-(t.originalEvent.targetTouches[0].clientX-p)+2*e.options.cropper.antWidth});break;case m:o.css({width:t.originalEvent.targetTouches[0].clientX-p})}n.css({top:s-o.position().top-e.options.cropper.antWidth,left:h-o.position().left-e.options.cropper.antWidth})}return!1};e.dom.$wrap.on("touchstart",".cropper-box-client-bar",function(n){return d=/cropper-box-client-(.)\s/.exec(t(n.target)[0].className)[1],!!((""+m+w+b+x).indexOf(d)+1)&&(n.preventDefault(),r=o.width(),c=o.height(),p=o.offset().left,a=o.offset().top,s=i.position().top,h=i.position().left,e.dom.$wrap.on("touchmove",l),void t(document).one("touchend",function(){e.dom.$wrap.off("touchmove",l),r=o.width(),c=o.height(),p=o.offset().left,a=o.offset().top,s=i.position().top,h=i.position().left}))})}function p(){var e=this,o=this.dom.$client,i=this.dom.$ele0,n=this.dom.$ele1,r=void 0,c=void 0,p=void 0,a=void 0,s=void 0,h=void 0,d=void 0,l=function(t){if(t.preventDefault(),t.clientX-e.cache.wrapLeft>=0&&t.clientX-e.cache.wrapLeft<=e.cache.width&&t.clientY-e.cache.wrapTop>=0&&t.clientY-e.cache.wrapTop<=e.cache.height){switch(d){case x:o.css({top:t.clientY-e.cache.wrapTop,height:c-(t.clientY-a)+2*e.options.cropper.antWidth});break;case b:o.css({height:t.clientY-a});break;case w:o.css({left:t.clientX-e.cache.wrapLeft,width:r-(t.clientX-p)+2*e.options.cropper.antWidth});break;case m:o.css({width:t.clientX-p})}n.css({top:s-o.position().top-e.options.cropper.antWidth,left:h-o.position().left-e.options.cropper.antWidth})}return!1};e.dom.$wrap.on("mousedown",".cropper-box-client-bar",function(n){return d=/cropper-box-client-(.)\s/.exec(t(n.target)[0].className)[1],!!("nswe".indexOf(d)+1)&&(n.preventDefault(),r=o.width(),c=o.height(),p=o.offset().left,a=o.offset().top,s=i.position().top,h=i.position().left,e.dom.$wrap.on("mousemove",l),void t(document).one("mouseup",function(){e.dom.$wrap.off("mousemove",l),r=o.width(),c=o.height(),p=o.offset().left,a=o.offset().top,s=i.position().top,h=i.position().left}))})}function a(){function t(t){o.trigger("change")}var e=this,o=e.dom.$range,i=e.dom.$ele0,n=e.dom.$ele1,r=e.cache.width,c=e.cache.height,p=e.cache.value,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0;o.on("change",function(t){return p!==o.val()&&(e.cache.value=p=o.val(),i.css({width:r*p,height:c*p,top:a-r*(p-l)/2,left:s-c*(p-l)/2}),void n.css({width:r*p,height:c*p,top:h-r*(p-l)/2,left:d-c*(p-l)/2}))}),o.on("mousedown",function(e){a=i.position().top,s=i.position().left,h=n.position().top,d=n.position().left,l=p,o.on("mousemove",t)}),o.on("mouseup",function(e){o.off("mousemove",t)})}function s(){function t(t){o.trigger("change")}var e=this,o=e.dom.$range,i=e.dom.$ele0,n=e.dom.$ele1,r=e.cache.width,c=e.cache.height,p=e.cache.value,a=void 0,s=void 0,h=void 0,d=void 0,l=void 0;o.on("change",function(t){return p!==o.val()&&(e.cache.value=p=o.val(),i.css({width:r*p,height:c*p,top:a-r*(p-l)/2,left:s-c*(p-l)/2}),void n.css({width:r*p,height:c*p,top:h-r*(p-l)/2,left:d-c*(p-l)/2}))}),o.on("touchstart",function(e){a=i.position().top,s=i.position().left,h=n.position().top,d=n.position().left,l=p,o.on("touchmove",t)}),o.on("touchend",function(e){o.off("touchmove",t)})}function h(){function e(t){t.preventDefault(),n.css({top:s+t.originalEvent.targetTouches[0].clientY-a,left:h+t.originalEvent.targetTouches[0].clientX-p}),r.css({top:d+t.originalEvent.targetTouches[0].clientY-a,left:l+t.originalEvent.targetTouches[0].clientX-p})}var o=this,i=this.dom.$wrap,n=this.dom.$ele0,r=this.dom.$ele1,c=void 0,p=void 0,a=void 0,s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left;i.on("touchstart",function(f){c=t(f.target)[0].className,p=f.originalEvent.targetTouches[0].clientX,a=f.originalEvent.targetTouches[0].clientY,s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left,f.preventDefault(),c.indexOf("cropper-box-client-bar")+1!==0||o.options.cropper.fixed||(i.on("touchmove",e),t(document).one("touchend",function(){i.off("touchmove",e),s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left}))})}function d(){function e(t){t.preventDefault(),n.css({top:s+t.clientY-a,left:h+t.clientX-p}),r.css({top:d+t.clientY-a,left:l+t.clientX-p})}var o=this,i=this.dom.$wrap,n=this.dom.$ele0,r=this.dom.$ele1,c=void 0,p=void 0,a=void 0,s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left;i.on("mousedown",function(f){c=t(f.target)[0].className,p=f.clientX,a=f.clientY,s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left,f.preventDefault(),c.indexOf("cropper-box-client-bar")+1!==0||o.options.cropper.fixed||(i.on("mousemove",e),t(document).one("mouseup",function(){i.off("mousemove",e),s=n.position().top,h=n.position().left,d=r.position().top,l=r.position().left}))})}var l=/([a-z\d])([A-Z])/g,f=/android|iphone/i,u=/(data:image\/(?:png|jpeg|gif);base64,)/i,v="cropperImage",g="cropperBoxClientTargetImage",m="e",w="w",b="s",x="n",$="image/jpeg",T="file",y="top",C="bottom",E="rgba(0,0,0,0.65)",k="#ccc",_=navigator.userAgent,L=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),P={outputType:T,range:{min:1,max:5,step:.05,init:1,pos:C},cropper:{minSpace:30,fixed:!1,antWidth:1},canvas:{type:$,quality:.7}},W='\n<div class="cropper-mask" id="cropperMask">\n    <div class="cropper-box" id="cropperBox">\n        <!-- 图片 -->\n\n        <!-- cropper-box-mask 用于实现阴影遮罩 -->\n        <div class="cropper-box-mask" id="cropperBoxMask"></div>\n        <div class="cropper-box-client" id="cropperBoxClient">\n            <div class="cropper-box-client-target" id="cropperBoxClientTarget">\n                <!-- 图片 -->\n            </div>\n            <div class="cropper-box-client-n cropper-box-client-bar"></div>\n            <div class="cropper-box-client-s cropper-box-client-bar"></div>\n            <div class="cropper-box-client-w cropper-box-client-bar"></div>\n            <div class="cropper-box-client-e cropper-box-client-bar"></div>\n        </div>\n    </div>\n    <input type="button" value="确认裁剪" class="cropper-ensure" id="cropperEnsure">\n    <div class="cropper-range" id="cropperRange">\n        <input type="range" min="1" max="5" step="0.05" value="1">\n    </div>\n</div>\n',D="\nbody, html {\n    padding: 0;\n    margin: 0;\n}\n.cropper-box-mask {\n    width: 100%;\n    height: 100%;\n    opacity: .4;\n    background-color: black;\n}\n.cropper-box-client {\n    overflow: hidden;\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-sizing: border-box;\n    border: 1px dashed red;\n    background-color: transparent;\n}\n.cropper-box-client-target {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n.cropper-box-client-n {\n    position: absolute;\n    height: 48px;\n    width: 100%;\n    cursor: ns-resize;\n    top: -24px;\n    left: 0;\n}\n.cropper-box-client-s {\n    position: absolute;\n    width: 100%;\n    height: 48px;\n    cursor: ns-resize;\n    bottom: -24px;\n    left: 0;\n}\n.cropper-box-client-w {\n    position: absolute;\n    height: 100%;\n    width: 48px;\n    cursor: ew-resize;\n    left: -24px;\n    top: 0;\n}\n.cropper-box-client-e {\n    position: absolute;\n    width: 48px;\n    height: 100%;\n    cursor: ew-resize;\n    right: -24px;\n    top: 0;\n}\n.cropper-box-client-n:after, .cropper-box-client-s:after, .cropper-box-client-w:after, .cropper-box-client-e:after {\n    content: '';\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    border: 1px solid red;\n}\n.cropper-box-client-n:after {\n    top: 20px;\n    left: 50%;\n    margin-left: -4px;\n}\n.cropper-box-client-s:after {\n    top: 20px;\n    left: 50%;\n    margin-left: -4px;\n}\n.cropper-box-client-w:after {\n    top: 50%;\n    left: 20px;\n    margin-top: -4px;\n}\n.cropper-box-client-e:after {\n    top: 50%;\n    right: 20px;\n    margin-top: -4px;\n}\n.cropper-range input {\n    display: inline-block;\n}\n",X={_init:function(){var o=t(this.$element),n=this;return!!i(o[0])&&void e(o[0],function(t,e){n._render(t,e),f.test(_)?(n._rectPhone(),n._zoomPhone(),n._dragPhone()):(n._rectPC(),n._zoomPC(),n._dragPC()),n._bindEnsure()})},_render:r,_rectPC:p,_rectPhone:c,_zoomPC:a,_zoomPhone:s,_dragPC:d,_dragPhone:h,_count:function(){var t=this,e=t.dom.$client,o=t.dom.$ele0,i=void 0,n=void 0,r=void 0,c=void 0;r=t.data.w=e.outerWidth()/(t.cache.ratio*t.cache.value),c=t.data.h=e.outerHeight()/(t.cache.ratio*t.cache.value),i=(e.offset().left-o.offset().left)/(t.cache.ratio*t.cache.value),n=(e.offset().top-o.offset().top)/(t.cache.ratio*t.cache.value),t.data.x=i,t.data.y=n,t.data.w=r,t.data.h=c},_bindEnsure:function(){var e=this,o=e.dom.$mask,i=e.dom.$btn;i.on("click",function(){e._count(),o.remove(),t.isFunction(e.callback)&&(e.options.outputType!==T?e.callback(t.extend({ele:e.$element},e.data)):e.callback(e._canvasCropper()))})},_canvasCropper:function(){var e=this,o=e.data.x,i=e.data.y,r=e.data.w,c=e.data.h,p=e.$element.clone().removeAttr("id").removeAttr("class").removeAttr("style")[0],a=t('<canvas width="'+r+'" height="'+c+'"></canvas>')[0],s=a.getContext("2d"),h=void 0,d=void 0,l=void 0;return s.drawImage(p,o,i,r,c,0,0,r,c),h=e.options.canvas.type.toLowerCase()===$?a.toDataURL(e.options.canvas.type.toLowerCase(),e.options.canvas.quality):a.toDataURL(e.options.canvas.type.toLowerCase()),d=n(h),l=new File([d],"img$".concat(Math.random().toString().slice(2)),{type:e.options.canvas.type.toLowerCase()})},resetPos:function(){var t=this,e=t.dom.$ele0,o=t.dom.$ele1,i=t.dom.$range,n=t.dom.$client;i.val(1).trigger("change"),e.css({top:0,left:0}),o.css({top:-t.options.cropper.antWidth,left:-t.options.cropper.antWidth}),n.css({width:t.cache.width,height:t.cache.height,top:0,left:0})},setOptions:function(e){var o=this;t.extend(!0,o.options,t.isPlainObject(e)&&e)},fixImg:function(){var t=this;t.setOptions({cropper:{fixed:!0}})}},Y=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},A=function e(o,i,n){Y(this,e),this.$element=t(o),this.options=t.extend(!0,{},e.DEFAULTS,t.isPlainObject(i)&&i),this.cache={},this.dom={},this.data={x:0,y:0,w:0,h:0},this.callback=n};A.DEFAULTS=P,A.prototype=X,X.constructor=A,t.fn.cropper=function(e,o){var i=t(this),n=new A(i,e,o);return n._init(),n},t.fn.cropper.Constructor=A,A.other=t.fn.cropper,t.fn.cropper.noConflict=function(){return t.fn.cropper=A.other,this},A.setDefaults=function(e){t.extend(!0,A.DEFAULTS,e)},t.fn.cropper.setDefaults=A.setDefaults});
//# sourceMappingURL=cropper.min.map