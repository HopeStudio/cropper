!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,o){return void 0===o&&(o="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(o),o}:t(jQuery)}(function(t){"use strict";function e(t,e){var o=void 0;return t.naturalWidth&&!P?e(t.naturalWidth,t.naturalHeight):(o=document.createElement("img"),o.onload=function(){e(this.width,this.height)},void(o.src=t.src))}function o(t){return"string"==typeof t&&(t=t.replace(l,"$1-$2").toLowerCase())}function i(t){return!!t&&!(!t.nodeName||"img"!==t.nodeName.toLowerCase()||!t.src)}function n(t){if(u.test(t)){t=t.replace(RegExp.$1,"");for(var e=window.atob(t),o=e.length,i=new Uint8Array(o),n=0;n<o;n++)i[n]=e.charCodeAt(n);return i.buffer}}function c(e,i){var n=this.dom.$mask=t(X),c=this.dom.$wrap=n.find("#cropperBox"),r=this.dom.$client=n.find("#cropperBoxClient"),a=this.dom.$target=n.find("#cropperBoxClientTarget"),p=this.dom.$range=n.find("#cropperRange input"),s=this.dom.$btn=n.find("#cropperEnsure"),h=this.dom.$ele0=t("<img/>").attr({class:o(v),id:v,src:this.$element.attr("src")}).prependTo(c),d=this.dom.$ele1=t("<img/>").attr({class:o(g),id:g,src:this.$element.attr("src")}).prependTo(a),l=this.options.cropper.minSpace,f=this.cache.value=p.val(),u=t(window),m=void 0,w=void 0;e<t(window).width()-2*l&&i<t(window).height()-4*l?(m=this.cache.width=e,w=this.cache.height=i,this.cache.ratio=1):(e/i<=t(window).width()/t(window).height()?(w=this.cache.height=t(window).height()-4*l,m=this.cache.width=w*e/i):(m=this.cache.width=t(window).width()-2*l,w=this.cache.height=m*i/e),this.cache.ratio=m/e),n.css({width:u.width(),height:u.height(),backgroundColor:E,position:"fixed",top:0,left:0,zIndex:1e4}),c.css({width:m,height:w,position:"absolute",left:(n.width()-m)/2,top:(n.height()-w)/4,overflow:"hidden",backgroundColor:L}),h.css({width:m*f,position:"absolute",top:0,left:0}),n.prependTo("body"),s.css({top:c.height()+c.position().top+10,left:n.width()/2,marginLeft:-s.width()/2,position:"absolute"}),this.cache.wrapTop=c.position().top,this.cache.wrapLeft=c.position().left,this.options.range.pos===y?p.parent().css({top:this.cache.wrapTop-l,left:n.width()/2,marginLeft:-p.width()/2,position:"absolute"}):p.parent().css({top:w+this.cache.wrapTop+l,left:n.width()/2,marginLeft:-p.width()/2,position:"absolute"}),r.css({width:m,height:w,top:0,left:0}),d.css({position:"absolute",width:m*f,height:w*f,top:-this.options.cropper.antWidth,left:-this.options.cropper.antWidth}),t("style#cropperStyleSheet")[0]||t("<style/>").html(Y).attr({id:"cropperStyleSheet"}).appendTo("head")}function r(){var e=this,o=this.dom.$client,i=this.dom.$ele0,n=this.dom.$ele1,c=o.width(),r=o.height(),a=o.offset().left,p=o.offset().top,s=i.offset().top,h=i.offset().left,d=void 0,l=function(t){return t.preventDefault(),t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft>=0&&t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft<=e.cache.width&&t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop>=0&&t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop<=e.cache.height&&(d===x?o.css({top:t.originalEvent.targetTouches[0].clientY-e.cache.wrapTop,height:r-(t.originalEvent.targetTouches[0].clientY-p)+2*e.options.cropper.antWidth}):d===b?o.css({height:t.originalEvent.targetTouches[0].clientY-p}):d===w?o.css({left:t.originalEvent.targetTouches[0].clientX-e.cache.wrapLeft,width:c-(t.originalEvent.targetTouches[0].clientX-a)+2*e.options.cropper.antWidth}):d===m&&o.css({width:t.originalEvent.targetTouches[0].clientX-a}),n.css({top:s-o.position().top-e.options.cropper.antWidth,left:h-o.position().left-e.options.cropper.antWidth})),!1};e.dom.$wrap.on("touchstart",".cropper-box-client-bar",function(n){return d=/cropper-box-client-(.)\s/.exec(t(n.target)[0].className)[1],!!((""+m+w+b+x).indexOf(d)+1)&&(n.preventDefault(),s=i.position().top,h=i.position().left,e.dom.$wrap.on("touchmove",l),void t(document).one("touchend",function(){e.dom.$wrap.off("touchmove",l),c=o.width(),r=o.height(),a=o.offset().left,p=o.offset().top}))})}function a(){var e=this,o=this.dom.$client,i=this.dom.$ele0,n=this.dom.$ele1,c=o.width(),r=o.height(),a=o.offset().left,p=o.offset().top,s=i.offset().top,h=i.offset().left,d=void 0,l=function(t){return t.preventDefault(),t.clientX-e.cache.wrapLeft>=0&&t.clientX-e.cache.wrapLeft<=e.cache.width&&t.clientY-e.cache.wrapTop>=0&&t.clientY-e.cache.wrapTop<=e.cache.height&&(d===x?o.css({top:t.clientY-e.cache.wrapTop,height:r-(t.clientY-p)+2*e.options.cropper.antWidth}):d===b?o.css({height:t.clientY-p}):d===w?o.css({left:t.clientX-e.cache.wrapLeft,width:c-(t.clientX-a)+2*e.options.cropper.antWidth}):d===m&&o.css({width:t.clientX-a}),n.css({top:s-o.position().top-e.options.cropper.antWidth,left:h-o.position().left-e.options.cropper.antWidth})),!1};e.dom.$wrap.on("mousedown",".cropper-box-client-bar",function(n){return d=/cropper-box-client-(.)\s/.exec(t(n.target)[0].className)[1],!!("nswe".indexOf(d)+1)&&(n.preventDefault(),s=i.position().top,h=i.position().left,e.dom.$wrap.on("mousemove",l),void t(document).one("mouseup",function(){e.dom.$wrap.off("mousemove",l),c=o.width(),r=o.height(),a=o.offset().left,p=o.offset().top}))})}function p(){function t(t){o.trigger("change")}var e=this,o=e.dom.$range,i=e.dom.$ele0,n=e.dom.$ele1,c=e.cache.width,r=e.cache.height,a=e.cache.value,p=void 0,s=void 0,h=void 0,d=void 0,l=void 0;o.on("change",function(t){return a!==o.val()&&(e.cache.value=a=o.val(),i.css({width:c*a,height:r*a,top:p-c*(a-l)/2,left:s-r*(a-l)/2}),void n.css({width:c*a,height:r*a,top:h-c*(a-l)/2,left:d-r*(a-l)/2}))}),o.on("mousedown",function(e){p=i.position().top,s=i.position().left,h=n.position().top,d=n.position().left,l=a,o.on("mousemove",t)}),o.on("mouseup",function(e){o.off("mousemove",t)})}function s(){function t(t){o.trigger("change")}var e=this,o=e.dom.$range,i=e.dom.$ele0,n=e.dom.$ele1,c=e.cache.width,r=e.cache.height,a=e.cache.value,p=void 0,s=void 0,h=void 0,d=void 0,l=void 0;o.on("change",function(t){return a!==o.val()&&(e.cache.value=a=o.val(),i.css({width:c*a,height:r*a,top:p-c*(a-l)/2,left:s-r*(a-l)/2}),void n.css({width:c*a,height:r*a,top:h-c*(a-l)/2,left:d-r*(a-l)/2}))}),o.on("touchstart",function(e){p=i.position().top,s=i.position().left,h=n.position().top,d=n.position().left,l=a,o.on("touchmove",t)}),o.on("touchend",function(e){o.off("touchmove",t)})}function h(){function e(t){t.preventDefault(),n.css({top:s+t.originalEvent.targetTouches[0].clientY-p,left:h+t.originalEvent.targetTouches[0].clientX-a}),c.css({top:d+t.originalEvent.targetTouches[0].clientY-p,left:l+t.originalEvent.targetTouches[0].clientX-a})}var o=this,i=this.dom.$wrap,n=this.dom.$ele0,c=this.dom.$ele1,r=void 0,a=void 0,p=void 0,s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left;i.on("touchstart",function(f){r=t(f.target)[0].className,a=f.originalEvent.targetTouches[0].clientX,p=f.originalEvent.targetTouches[0].clientY,s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left,f.preventDefault(),r.indexOf("cropper-box-client-bar")+1!==0||o.options.cropper.fixed||(i.on("touchmove",e),t(document).one("touchend",function(){i.off("touchmove",e()),s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left}))})}function d(){function e(t){t.preventDefault(),n.css({top:s+t.clientY-p,left:h+t.clientX-a}),c.css({top:d+t.clientY-p,left:l+t.clientX-a})}var o=this,i=this.dom.$wrap,n=this.dom.$ele0,c=this.dom.$ele1,r=void 0,a=void 0,p=void 0,s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left;i.on("mousedown",function(f){r=t(f.target)[0].className,a=f.clientX,p=f.clientY,s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left,f.preventDefault(),r.indexOf("cropper-box-client-bar")+1!==0||o.options.cropper.fixed||(i.on("mousemove",e),t(document).one("mouseup",function(){i.off("mousemove",e),s=n.position().top,h=n.position().left,d=c.position().top,l=c.position().left}))})}var l=/([a-z\d])([A-Z])/g,f=/android|iphone/i,u=/(data:image\/(?:png|jpeg|gif);base64,)/i,v="cropperImage",g="cropperBoxClientTargetImage",m="e",w="w",b="s",x="n",$="image/jpeg",T="file",y="top",C="bottom",E="rgba(0,0,0,0.65)",L="#ccc",k=navigator.userAgent,P=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),W={outputType:T,range:{min:1,max:5,step:.05,init:1,pos:C},cropper:{minSpace:30,fixed:!1,antWidth:2},canvas:{type:$,quality:.7}},X='\n<div class="cropper-mask" id="cropperMask">\n    <div class="cropper-box" id="cropperBox">\n        <!-- 图片 -->\n\n        <!-- cropper-box-mask 用于实现阴影遮罩 -->\n        <div class="cropper-box-mask" id="cropperBoxMask"></div>\n        <div class="cropper-box-client" id="cropperBoxClient">\n            <div class="cropper-box-client-target" id="cropperBoxClientTarget">\n                <!-- 图片 -->\n            </div>\n            <div class="cropper-box-client-n cropper-box-client-bar"></div>\n            <div class="cropper-box-client-s cropper-box-client-bar"></div>\n            <div class="cropper-box-client-w cropper-box-client-bar"></div>\n            <div class="cropper-box-client-e cropper-box-client-bar"></div>\n        </div>\n    </div>\n    <input type="button" value="确认裁剪" class="cropper-ensure" id="cropperEnsure">\n    <div class="cropper-range" id="cropperRange">\n        <input type="range" min="1" max="5" step="0.05" value="1">\n    </div>\n</div>\n',Y="\nbody, html {\n    padding: 0;\n    margin: 0;\n}\n.cropper-box-mask {\n    width: 100%;\n    height: 100%;\n    opacity: .4;\n    background-color: black;\n}\n.cropper-box-client {\n    overflow: hidden;\n    position: absolute;\n    top: 0;\n    left: 0;\n    box-sizing: border-box;\n    border: 2px dashed red;\n    background-color: transparent;\n}\n.cropper-box-client-target {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n.cropper-box-client-n {\n    position: absolute;\n    height: 48px;\n    width: 100%;\n    cursor: ns-resize;\n    top: -24px;\n    left: 0;\n}\n.cropper-box-client-s {\n    position: absolute;\n    width: 100%;\n    height: 48px;\n    cursor: ns-resize;\n    bottom: -24px;\n    left: 0;\n}\n.cropper-box-client-w {\n    position: absolute;\n    height: 100%;\n    width: 48px;\n    cursor: ew-resize;\n    left: -24px;\n    top: 0;\n}\n.cropper-box-client-e {\n    position: absolute;\n    width: 48px;\n    height: 100%;\n    cursor: ew-resize;\n    right: -24px;\n    top: 0;\n}\n.cropper-range input {\n    display: inline-block;\n}\n",D={init:function(){var o=t(this.$element),n=this;return!!i(o[0])&&void e(o[0],function(t,e){n.render(t,e),f.test(k)?(n.rectPhone(),n.zoomPhone(),n.dragPhone()):(n.rectPC(),n.zoomPC(),n.dragPC()),n.bindEnsure()})},render:c,rectPC:a,rectPhone:r,zoomPC:p,zoomPhone:s,dragPC:d,dragPhone:h,count:function(){var t=this,e=t.dom.$client,o=t.dom.$ele0,i=void 0,n=void 0,c=void 0,r=void 0;c=(t.data.w=e.width()+2*t.options.cropper.antWidth)/(t.cache.ratio*t.cache.value),r=(t.data.h=e.height()+2*t.options.cropper.antWidth)/(t.cache.ratio*t.cache.value),i=(e.offset().left-o.offset().left)/(t.cache.ratio*t.cache.value),n=(e.offset().top-o.offset().top)/(t.cache.ratio*t.cache.value),t.data.x=i,t.data.y=n,t.data.w=c,t.data.h=r},bindEnsure:function(){var e=this,o=e.dom.$mask,i=e.dom.$btn;i.on("click",function(){e.count(),o.remove(),t.isFunction(e.callback)&&(e.options.outputType!==T?e.callback(t.extend({ele:e.$element},e.data)):e.callback(e.canvasCropper()))})},canvasCropper:function(){var e=this,o=e.data.x,i=e.data.y,c=e.data.w,r=e.data.h,a=e.$element.clone().removeAttr("id").removeAttr("class").removeAttr("style")[0],p=t('<canvas width="'+c+'" height="'+r+'"></canvas>')[0],s=p.getContext("2d"),h=void 0,d=void 0,l=void 0;return s.drawImage(a,o,i,c,r,0,0,c,r),h=e.options.canvas.type.toLowerCase()===$?p.toDataURL(e.options.canvas.type.toLowerCase(),e.options.canvas.quality):p.toDataURL(e.options.canvas.type.toLowerCase()),d=n(h),l=new File([d],"img$".concat(Math.random().toString().slice(2)),{type:e.options.canvas.type.toLowerCase()})}},z=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},A=function e(o,i,n){z(this,e),this.$element=t(o),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(i)&&i),this.cache={},this.dom={},this.data={x:0,y:0,w:0,h:0},this.callback=n};A.DEFAULTS=W,A.prototype=D,D.constructor=A,t.fn.cropper=function(e,o){var i=t(this),n=new A(i,e,o);n.init()},A.other=t.fn.cropper,t.fn.cropper.Constructor=A,t.fn.cropper.noConflict=function(){return t.fn.cropper=A.other,this}});
//# sourceMappingURL=cropper.min.map